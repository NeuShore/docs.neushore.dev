"use strict";(self.webpackChunkbrayanbot_dev=self.webpackChunkbrayanbot_dev||[]).push([[3934],{4137:function(e,t,a){a.d(t,{Zo:function(){return p},kt:function(){return c}});var n=a(7294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var i=n.createContext({}),u=function(e){var t=n.useContext(i),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},p=function(e){var t=u(e.components);return n.createElement(i.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,r=e.originalType,i=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),m=u(a),c=o,h=m["".concat(i,".").concat(c)]||m[c]||d[c]||r;return a?n.createElement(h,s(s({ref:t},p),{},{components:a})):n.createElement(h,s({ref:t},p))}));function c(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=a.length,s=new Array(r);s[0]=m;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l.mdxType="string"==typeof e?e:o,s[1]=l;for(var u=2;u<r;u++)s[u]=a[u];return n.createElement.apply(null,s)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},3881:function(e,t,a){a.r(t),a.d(t,{assets:function(){return p},contentTitle:function(){return i},default:function(){return c},frontMatter:function(){return l},metadata:function(){return u},toc:function(){return d}});var n=a(3117),o=a(102),r=(a(7294),a(4137)),s=["components"],l={title:"Hardening your Linux Server",description:"Because all have to secure our penguins.",slug:"hardening-linux-server",authors:[{name:"NotAShelf (raf)",title:"BrayanBot Developer & Lead Wiki Maintainer",url:"https://github.com/NotAShelf",image_url:"https://notashelf.dev/_next/image/?url=https%3A%2F%2Fmedia.discordapp.net%2Fattachments%2F815616931788357652%2F818941172591624192%2Fraf.jpg&w=256&q=75"}],tags:["Linux","Ubuntu","Security"],hide_table_of_contents:!1},i=void 0,u={permalink:"/blog/hardening-linux-server",editUrl:"https://github.com/brayanbotdev/brayanbot/edit/dev/blog/2022-02-17-securing-linux.md",source:"@site/blog/2022-02-17-securing-linux.md",title:"Hardening your Linux Server",description:"Because all have to secure our penguins.",date:"2022-02-17T00:00:00.000Z",formattedDate:"February 17, 2022",tags:[{label:"Linux",permalink:"/blog/tags/linux"},{label:"Ubuntu",permalink:"/blog/tags/ubuntu"},{label:"Security",permalink:"/blog/tags/security"}],readingTime:16.92,truncated:!0,authors:[{name:"NotAShelf (raf)",title:"BrayanBot Developer & Lead Wiki Maintainer",url:"https://github.com/NotAShelf",image_url:"https://notashelf.dev/_next/image/?url=https%3A%2F%2Fmedia.discordapp.net%2Fattachments%2F815616931788357652%2F818941172591624192%2Fraf.jpg&w=256&q=75",imageURL:"https://notashelf.dev/_next/image/?url=https%3A%2F%2Fmedia.discordapp.net%2Fattachments%2F815616931788357652%2F818941172591624192%2Fraf.jpg&w=256&q=75"}],frontMatter:{title:"Hardening your Linux Server",description:"Because all have to secure our penguins.",slug:"hardening-linux-server",authors:[{name:"NotAShelf (raf)",title:"BrayanBot Developer & Lead Wiki Maintainer",url:"https://github.com/NotAShelf",image_url:"https://notashelf.dev/_next/image/?url=https%3A%2F%2Fmedia.discordapp.net%2Fattachments%2F815616931788357652%2F818941172591624192%2Fraf.jpg&w=256&q=75",imageURL:"https://notashelf.dev/_next/image/?url=https%3A%2F%2Fmedia.discordapp.net%2Fattachments%2F815616931788357652%2F818941172591624192%2Fraf.jpg&w=256&q=75"}],tags:["Linux","Ubuntu","Security"],hide_table_of_contents:!1},prevItem:{title:"Windows GUI Installation",permalink:"/blog/windows-gui-installation"},nextItem:{title:"Hosting BrayanBot on a Raspberry Pi 400",permalink:"/blog/raspberry-pi-installation"}},p={authorsImageUrls:[void 0]},d=[{value:"Preface",id:"preface",level:2},{value:"Requisites",id:"requisites",level:3},{value:"Recommendations",id:"recommendations",level:3},{value:"Root Access",id:"root-access",level:2},{value:"Passwords",id:"passwords",level:3},{value:"Password Policies",id:"password-policies",level:3},{value:"Things to note",id:"things-to-note",level:4},{value:"Limiting root privileges",id:"limiting-root-privileges",level:3},{value:"SSH",id:"ssh",level:2},{value:"SSH Keys",id:"ssh-keys",level:3},{value:"SSH Config",id:"ssh-config",level:3},{value:"Securing SSH",id:"securing-ssh",level:3},{value:"Disabling Password Authentication",id:"disabling-password-authentication",level:4},{value:"Changing your SSH port",id:"changing-your-ssh-port",level:4},{value:"Disable root login",id:"disable-root-login",level:4},{value:"Firewall",id:"firewall",level:2},{value:"Comparison",id:"comparison",level:3},{value:"UFW",id:"ufw",level:3},{value:"IPTABLES",id:"iptables",level:3},{value:"What does this do?",id:"what-does-this-do",level:4},{value:"SaaS Firewalls",id:"saas-firewalls",level:3},{value:"Additional notes",id:"additional-notes",level:3},{value:"Virus Scanning",id:"virus-scanning",level:2},{value:"Installing ClamAV",id:"installing-clamav",level:3}],m={toc:d};function c(e){var t=e.components,l=(0,o.Z)(e,s);return(0,r.kt)("wrapper",(0,n.Z)({},m,l,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,'No server is 100% secure -and if you want an impenetrable server, you would need to unplug your machine and throw it into the trash bin- but we can at least do our best to make our server secure and a safe box for our data, which is why this guide exists. Ready? Great! Click "Read More" and... well, prepare to ',(0,r.kt)("em",{parentName:"p"},"read more"),"."),(0,r.kt)("h2",{id:"preface"},"Preface"),(0,r.kt)("p",null,"If you are running a server that is connected to the internet, there is a huge chance that you have chosen Linux as your server's operating system. And while Linux is, by default, a system more secure than Windows; it will be much more secure once you take the required actions and turn it into a fortress."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"While this guide will cover primarly the steps for an ",(0,r.kt)("strong",{parentName:"p"},"Ubuntu")," server, the process is not too different for similar systems.")),(0,r.kt)("p",null,"This guide will assume that you are on a ",(0,r.kt)("strong",{parentName:"p"},"fresh (if not a not-yet-configured) installation")," of Ubuntu and are running version 20.04 LTS. This guide may -and probably will- apply to newer (or with lesser chance of success, older) versions but it is prepared on a server running Ubuntu 20.04 LTS and I rarely feel the need to downgrade to older versions. 21.04 is one of the worst Ubuntu versions to day, and 22.04 (next LTS release) is well on the way. Until 22.04 is out, let us stick with 20.04 and do our absolute best to secure our server."),(0,r.kt)("h3",{id:"requisites"},"Requisites"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Root Access"),(0,r.kt)("li",{parentName:"ul"},"A stable connection to the internet"),(0,r.kt)("li",{parentName:"ul"},"Packages like ",(0,r.kt)("inlineCode",{parentName:"li"},"nano")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"vim")," installed"),(0,r.kt)("li",{parentName:"ul"},"Ubuntu 20.04"),(0,r.kt)("li",{parentName:"ul"},"A SSH client (on Windows) or a Terminal Emulator (on Linux)"),(0,r.kt)("li",{parentName:"ul"},"Common sense")),(0,r.kt)("h3",{id:"recommendations"},"Recommendations"),(0,r.kt)("p",null,"Those are pretty self-explanatory, and often times you follow those steps without realizing. But, it is always great to mention them."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Update regularly or automatically.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Install only the necessary packages.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Enforce good password policies for your users.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Do not give your password to untrusted third parties and if you do for a good reason, change the passwords afterwards.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Do not allow access to your server from people you do not trust.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Keep regular backups"))),(0,r.kt)("h2",{id:"root-access"},"Root Access"),(0,r.kt)("p",null,"Once you purchase a VPS or a Dedicated Server, you will most likely be given access to the root user, who has full privileges. You may continue using root user, but you will need to keep in mind that running ",(0,r.kt)("strong",{parentName:"p"},"every")," application with root privileges (a result of using the root user) is unsafe and highly discouraged. Which is why, we will be creating our own non-root user with ",(0,r.kt)("strong",{parentName:"p"},"sudo privileges")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ssh root@ip_address\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"adduser username # replace username with your desired username\n")),(0,r.kt)("p",null,"You will be prompted with a few questions for your details. You do not need to provide any of those, but some software (like git) use those details to easily pull your details without you having to configure it twice. Needless to say, it is up to you."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo adduser dummy\n\nAdding user dummy ...\nAdding new group dummy (1001) ...\nAdding new user dummy (1001) with group dummy ...\nCreating home directory /home/raf2 ...\nCopying files from /etc/skel ...\nNew password: # enter your password - not optional\nRetype new password: # confirm your password - also not optional\npasswd: password updated successfully\nChanging the user information for dummy\nEnter the new value, or press ENTER for the default\n        Full Name []: # optional\n        Room Number []: # optional\n        Work Phone []: # optional\n        Home Phone []: # optional\n        Other []: # optional\nIs the information correct? [Y/n]\n")),(0,r.kt)("p",null,"Review your information, and type ",(0,r.kt)("inlineCode",{parentName:"p"},"Y")," to confirm user creation.",(0,r.kt)("br",null),"And this will do it for user creation, however, we still need to assign sudo privileges to this user before we ditch ",(0,r.kt)("strong",{parentName:"p"},"root")," and switch to our newly created user."),(0,r.kt)("h3",{id:"passwords"},"Passwords"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Passwords, without any doubt, are a part of our lives and no matter the platform; using a safe password is one of the easiest steps you can take to secure your server. Most hosting providers will generate a password that are ",(0,r.kt)("em",{parentName:"p"},"relatively")," secure but you must keep in mind that there is an algorithm behind the generation of those passwords and thus, they are prone to security vulnerabilities. Which means, you ",(0,r.kt)("strong",{parentName:"p"},"must")," create your own, more secure password. You can leave the root password as the default one, as we will be locking it later on, but it may still be a good idea to change it to something much more secure than the default.")),(0,r.kt)("p",null,"To change your ",(0,r.kt)("em",{parentName:"p"},"own")," password, run"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"passwd\n")),(0,r.kt)("p",null,"and enter your password, then confirm."),(0,r.kt)("p",null,"To change ",(0,r.kt)("em",{parentName:"p"},"another user's")," password, run"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"passwd username\n")),(0,r.kt)("p",null,"and enter the new password, then confirm."),(0,r.kt)("h3",{id:"password-policies"},"Password Policies"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"If you are a Sysadmin enforcing system-wide security within your server, you can enforce users to change their passwords periodically by setting them to expire. This is not necessary, and most users will likely negelct this step but if you choose to take the extra step; I will not judge and instead, will show you how.")),(0,r.kt)("p",null,"Enforcing a password expiry policy can be done by adding the ",(0,r.kt)("inlineCode",{parentName:"p"},"-e")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"--expire")," flag while running the ",(0,r.kt)("inlineCode",{parentName:"p"},"passwd")," command and forcing an user's password to expire (thus forcing them to change it) or automatically."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Install ",(0,r.kt)("inlineCode",{parentName:"li"},"chage")," package, it is included by default in some distributions but you may be missing it")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo apt-get install chage\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Use the ",(0,r.kt)("inlineCode",{parentName:"li"},"-M")," flag to set the amount of days between password changes. E.g. setting it to 10 will require an user to change their password every 10 days.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo chage -M 10 username\n")),(0,r.kt)("p",null,"This will force an user to change their password every 10 days, but I recommend that you choose a more reasonable amount."),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"To verify an user's expiry policy, run the ",(0,r.kt)("inlineCode",{parentName:"li"},"chage")," command with the ",(0,r.kt)("inlineCode",{parentName:"li"},"-l")," flag as follows:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"chage -l username\n")),(0,r.kt)("h4",{id:"things-to-note"},"Things to note"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"By default the number of days of warning before password expires is set to 7. The user will receive a warning about changing their password 7 days before the expiry date.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"If the password expiry date reaches and user doesn\u2019t change their password, the system will force the user to change the password before the login")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"You may also lock an user's account permanently, with the option to be recovered by an administrator, if they haven't logged in for a predetermined amount of days after their password expires. To do so, run ",(0,r.kt)("inlineCode",{parentName:"p"},"change")," with the ",(0,r.kt)("inlineCode",{parentName:"p"},"-I")," flag as follows:"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"chage -I 10 username\n")),(0,r.kt)("h3",{id:"limiting-root-privileges"},"Limiting root privileges"),(0,r.kt)("p",null,"As we have created our fresh user to use in the future, we need to assign sudo privileges to said user. ",(0,r.kt)("inlineCode",{parentName:"p"},"sudo")," allows this user to run applications as ",(0,r.kt)("strong",{parentName:"p"},"root")," without exposing your root user to ",(0,r.kt)("strong",{parentName:"p"},"exploits"),". Use ",(0,r.kt)("inlineCode",{parentName:"p"},"sudo")," only when necessary and avoid running applications with ",(0,r.kt)("inlineCode",{parentName:"p"},"sudo")," if you have no idea where they are from or what they do."),(0,r.kt)("p",null,"To allow our new user to run commands with ",(0,r.kt)("inlineCode",{parentName:"p"},"sudo"),", we need to add it to the ",(0,r.kt)("strong",{parentName:"p"},"sudo group")," by running the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"usermod -aG sudo username # replace username with your own username\n")),(0,r.kt)("p",null,"And that is it! Now switch to your sudo user with ",(0,r.kt)("inlineCode",{parentName:"p"},"su - username"),', once again replacing "username" with your username and test your sudo privileges with ',(0,r.kt)("inlineCode",{parentName:"p"},"sudo whoami"),". If the response is ",(0,r.kt)("strong",{parentName:"p"},"root"),", then you are successful."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Sudo",src:a(3745).Z,width:"263",height:"107"})),(0,r.kt)("h2",{id:"ssh"},"SSH"),(0,r.kt)("h3",{id:"ssh-keys"},"SSH Keys"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"SSH Keys are one of the most popular and effective systems to secure your server. And surprisingly easy too! Let's see how we can set up SSH Key Pairs in less than 5 steps.")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Generate your key pair by running the following command on your ",(0,r.kt)("strong",{parentName:"li"},"own machine"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ssh-keygen -t rsa\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Sample output:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Generating public/private rsa key pair.\nEnter file in which to save the key (/Users/raf/.ssh/id_rsa):\nEnter passphrase (empty for no passphrase): # optional\nEnter same passphrase again: # optional\nYour identification has been saved in /Users/raf/.ssh/id_rsa.\nYour public key has been saved in /Users/raf/.ssh/id_rsa.pub.\n")),(0,r.kt)("p",null,"This command will generate your key pair with the names ",(0,r.kt)("inlineCode",{parentName:"p"},"id_rsa")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"id_rsa.pub")," in the ssh directory"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"For Linux systems, this directory is located at ",(0,r.kt)("inlineCode",{parentName:"li"},"~/.ssh")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"/home/username/.ssh")," (both are the same)"),(0,r.kt)("li",{parentName:"ul"},"For Windows system, this directory will be located at ",(0,r.kt)("inlineCode",{parentName:"li"},"C:\\Users\\username\\.ssh"))),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Copy your public key (id_rsa.pub) to your ",(0,r.kt)("strong",{parentName:"li"},"server"))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Linux")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ssh-copy-id -i $HOME/.ssh/id_rsa.pub username@ip_address # replace username with your sudo user (not root) and ip_address with your server's IP address\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Windows")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'type $env:USERPROFILE\\.ssh\\id_rsa.pub | ssh username@ip_address "cat >> .ssh/authorized_keys" # replace username with your sudo user (not root) and ip_address with your server\'s IP address\n')),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"Test passwordless SSH connectivity")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ssh -v username@ip_address # replace username with your sudo user (not root) and ip_address with your server's IP address\n")),(0,r.kt)("h3",{id:"ssh-config"},"SSH Config"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"While not mandatory and not too significant for security, you can choose to configure your SSH connection. To do this, you will need to add an entry to the ",(0,r.kt)("inlineCode",{parentName:"p"},"config")," file located in your SSH directory as follows:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"Host server_name # desired hostname\n   HostName ip_address # your server's IP address\n   User username # username for the sudo user that you added SSH keys for\n   Port 22 # your SSH port, 22 is the default one\n   IdentityFile ~/.ssh/id_rsa # your private key\n")),(0,r.kt)("p",null,"Naturally, you need to edit those values to your liking but once you are done, you will be able to easily SSH into your server with"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ssh server_name\n")),(0,r.kt)("h3",{id:"securing-ssh"},"Securing SSH"),(0,r.kt)("p",null,"There are other things you can -and should- do to secure your SSH connection. Those things include:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Disable password authentication"),(0,r.kt)("li",{parentName:"ul"},"Change your SSH port (optional)"),(0,r.kt)("li",{parentName:"ul"},"Disable root login")),(0,r.kt)("p",null,"and can all be achieved from your SSHD config at ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/ssh/sshd_config")),(0,r.kt)("h4",{id:"disabling-password-authentication"},"Disabling Password Authentication"),(0,r.kt)("p",null,"Find ",(0,r.kt)("inlineCode",{parentName:"p"},"#PasswordAuthentication yes")," and replace ",(0,r.kt)("inlineCode",{parentName:"p"},"yes")," with ",(0,r.kt)("inlineCode",{parentName:"p"},"no"),"."),(0,r.kt)("div",{className:"admonition admonition-danger alert alert--danger"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"danger")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"It is very important that you do this ",(0,r.kt)("em",{parentName:"p"},"after")," setting up and testing your SSH keys. If you disable password authentication before you set up Pubkey authentication, you will lock yourself out of your server."))),(0,r.kt)("h4",{id:"changing-your-ssh-port"},"Changing your SSH port"),(0,r.kt)("p",null,"Find ",(0,r.kt)("inlineCode",{parentName:"p"},"#Port 22"),", uncomment it and replace 22 with your desired port number. Keep in mind that you will need to set your Firewall rules according to this setting, if you change it."),(0,r.kt)("h4",{id:"disable-root-login"},"Disable root login"),(0,r.kt)("p",null,"Find ",(0,r.kt)("inlineCode",{parentName:"p"},"PermitRootLogin")," and set it as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"PermitRootLogin no\n")),(0,r.kt)("p",null,'If it is commented (if there is a "#" before it\'s name,) uncomment it (remove the "#".)'),(0,r.kt)("h2",{id:"firewall"},"Firewall"),(0,r.kt)("p",null,"Firewall is a dangerous tool to play with, however, once you master it; you are able to fend your server from most attacks that target network exploits"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"While a lot of users neglect Firewall setup, I certainly recommend setting it up, however, if you are somewhat new to the whole Linux system and server administration, you may step this step. But make sure you follow other tips I have provided.")),(0,r.kt)("p",null,"There are 2 common applications that I keep hearing about and personally use: ",(0,r.kt)("inlineCode",{parentName:"p"},"UFW")," (Uncomplicated Firewall) and ",(0,r.kt)("inlineCode",{parentName:"p"},"iptables"),".\nWhile I do not recommend using a ",(0,r.kt)("em",{parentName:"p"},"specific")," one of those applications, you can easily choose the one that is for you based on the explanation below."),(0,r.kt)("h3",{id:"comparison"},"Comparison"),(0,r.kt)("p",null,"(Taken from ",(0,r.kt)("a",{parentName:"p",href:"https://serverfault.com/questions/1014531/ufw-and-iptables-which-is-better-and-why"},"here"),")"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"I ain't afraid of no quake")," I mean firewall! ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("sup",{parentName:"strong",id:"fnref-1"},(0,r.kt)("a",{parentName:"sup",href:"#fn-1",className:"footnote-ref"},"1")))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"TL;DR PART")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"a simple image about pizza can answer sometimes many questions :)"),(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"Take a good look at this picture, then read the text below:")),(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("img",{parentName:"p",src:"https://i.stack.imgur.com/qiEfi.png",alt:"(IMAGE) Pizza as a Service \u2014 by Albert Barron"})),(0,r.kt)("p",{parentName:"blockquote"},"We start from the left (blue means, you have to manage it, green means the vendor/software manages it)"),(0,r.kt)("ol",{parentName:"blockquote"},(0,r.kt)("li",{parentName:"ol"},"Made at Home - ",(0,r.kt)("strong",{parentName:"li"},"Netfilter")," (Nightmare - Damn I'm Good)"),(0,r.kt)("li",{parentName:"ol"},"Take and Bake - ",(0,r.kt)("strong",{parentName:"li"},"Iptables")," (Hard - Come Get Some)"),(0,r.kt)("li",{parentName:"ol"},"Delivery - ",(0,r.kt)("strong",{parentName:"li"},"UFW")," (Normal - Let's Rock)"),(0,r.kt)("li",{parentName:"ol"},"Dining out - ",(0,r.kt)("strong",{parentName:"li"},"Some 1-clicks or predefined setups")," (Easy - Piece of Cake)")),(0,r.kt)("p",{parentName:"blockquote"},"UFW is something like a simplistic interface to get basic things done with your firewall."),(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"How much you want to manage, depends solely on you :)"))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"THE LONGER PART")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"part I:")," I found a pretty decent and easy to understand article for the UFW: ",(0,r.kt)("a",{parentName:"p",href:"https://hackernoon.com/understanding-ufw-8d70d5d8f9d2"},"Understanding UFW")),(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"part II:")," This guide shows you the slight deeper using of iptables: ",(0,r.kt)("a",{parentName:"p",href:"https://www.howtogeek.com/177621/the-beginners-guide-to-iptables-the-linux-firewall/"},"The Beginner\u2019s Guide to iptables, the Linux Firewall")),(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"part III:")," Here is information about the packetfilter, this is the basis of many firewall solutions [A Deep Dive into Iptables and\n",(0,r.kt)("a",{parentName:"p",href:"https://www.digitalocean.com/community/tutorials/a-deep-dive-into-iptables-and-netfilter-architecture"},"Netfilter Architecture")),(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"The parts are based on hierarchy, top is dependant on the lower ones."))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("sup",{parentName:"strong",id:"fnref-1:"},(0,r.kt)("a",{parentName:"sup",href:"#fn-1:",className:"footnote-ref"},"1:")))," (From Duke Nukem 3D - Referencing id Software's 1996 PC FPS game Quake)"),(0,r.kt)("h3",{id:"ufw"},"UFW"),(0,r.kt)("p",null,'As the U in UFW ("uncomplicated") indicates; UFW is supposed to be a simple solution for managing your firewall. And as such, I try to keep my UFW configuration as simple as possible.'),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Install UFW")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo apt install ufw\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Check the status of your firewall")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo ufw status\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},'It will say "inactive" if you have not yet configured it. If it says "active", turn it off until we need it enabled')),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"Deny incoming packages and allow outgoing - don't worry, this will not cut off your SSH access as your firewall is currently ",(0,r.kt)("strong",{parentName:"li"},"inactive"),".")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo ufw default deny incoming\nsudo ufw default allow outgoing\n")),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},"Allow the SSH port")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo ufw allow 22 # If your SSH port is different, change it in this command.\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"or")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo ufw allow ssh # this will grab the details from your SSH profile\n")),(0,r.kt)("p",null,"You can also leave yourself a command while opening a port, like this"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo ufw allow 3000/tcp comment 'Open port for NextJS Application'\n")),(0,r.kt)("ol",{start:5},(0,r.kt)("li",{parentName:"ol"},"Allow other ports you want open")),(0,r.kt)("p",null,"I normally allow ports 80 and 443 for http and https access. Different services may require different ports.\nYou can also allow port ",(0,r.kt)("em",{parentName:"p"},"ranges")," using a semicolon as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo ufw allow 3000:3100/tcp\n")),(0,r.kt)("p",null,"For example this will allow TCP ports 3000 through 3100."),(0,r.kt)("ol",{start:6},(0,r.kt)("li",{parentName:"ol"},"Denying outgoing ports")),(0,r.kt)("p",null,"As we disabled all incoming, you do not need to deny any additional ports. However, if you want to disable any ",(0,r.kt)("em",{parentName:"p"},"outgoing")," ports; you can deny it by running"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo ufw reject out port # replace port with the port you want to deny\n")),(0,r.kt)("ol",{start:7},(0,r.kt)("li",{parentName:"ol"},"Limiting SSH port")),(0,r.kt)("p",null,"To mitigate package attacks, you can choose to limit traffic on certain ports. By default, UFW limits 6 connections per 30 seconds with SSH connections in mind."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo ufw limit ssh\n")),(0,r.kt)("ol",{start:8},(0,r.kt)("li",{parentName:"ol"},"Enabling UFW")),(0,r.kt)("p",null,"If you are satisfied with your UFW config, you are ready to enable UFW. But before, you might want to disable UFW from running on system boot by running"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo systemctl disable ufw\n")),(0,r.kt)("p",null,"and ",(0,r.kt)("em",{parentName:"p"},"only then")," enabling UFW"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo ufw enable # this will enable UFW\n")),(0,r.kt)("p",null,"If all is good, re-enable UFW service by running"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo systemctl enable ufw\n")),(0,r.kt)("p",null,"If you have managed to lock yourself out, reboot your server."),(0,r.kt)("ol",{start:9},(0,r.kt)("li",{parentName:"ol"},"Making Changes")),(0,r.kt)("p",null,"Whenever you make changes to your UFW configuration, you need to reload UFW"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo ufw reload\n")),(0,r.kt)("p",null,"To view active UFW rules"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo ufw status numbered # this will display a numbered list\n")),(0,r.kt)("p",null,"To delete an active UFW rule"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo ufw delete [number]\n")),(0,r.kt)("h3",{id:"iptables"},"IPTABLES"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},'Iptables is a relatively harder firewall to operate and as such, I treat it as one. While I can explain to you step by step, iptables unlike UFW has no intention to appear "uncomplicated" and explaining it would take far longer than this blog aims to be. Therefore, I will share my iptables setup with simple notes so that you can use it yourself, but I recommend sticking with UFW unless you ',(0,r.kt)("em",{parentName:"p"},"really")," know what you are doing.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT\n\nsudo iptables -A OUTPUT -m conntrack --ctstate ESTABLISHED -j ACCEPT\n\nsudo iptables -A INPUT -p tcp -s  MY.IP.0.0/16 --dport 22 -m conntrack --ctstate NEW,ESTABLISHED -j ACCEPT # allow SSH port for input with subnet for last 2 digits\n\nsudo iptables -A OUTPUT -p tcp --sport 22 -m conntrack --ctstate ESTABLISHED -j ACCEPT # allow SSH port for output\n\nsudo iptables -A INPUT -p tcp --dport 80 -j ACCEPT # allow http port\n\nsudo iptables -A INPUT -p tcp --dport 443 -j ACCEPT # allow https port\n\nsudo iptables -A INPUT -i lo -j ACCEPT\n\nsudo iptables -A OUTPUT -o lo -j ACCEPT\n\nsudo iptables -P INPUT DROP # deny all incoming traffic\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"As I mentioned, it's a really bad idea to use this if you have no idea what you are doing and it ",(0,r.kt)("em",{parentName:"p"},"is")," pretty dangerous to copy and paste but this could be your guide once you feel accustomed to Linux, and most specifically; firewalls")),(0,r.kt)("h4",{id:"what-does-this-do"},"What does this do?"),(0,r.kt)("p",null,"The commands you see above will quickly set up a firewall policy that denies all incoming traffic and allows all outgoing traffic. Then, it will allow SSH from my subnet",(0,r.kt)("sup",{parentName:"p",id:"fnref-2"},(0,r.kt)("a",{parentName:"sup",href:"#fn-2",className:"footnote-ref"},"2"))," and allow all outgoing SSH traffic. Then it will allow ports 80 and 443 to allow http and https access. Additional ports can be opened with"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo iptables -A INPUT -p tcp --dport 8080 -j ACCEPT # 8080 is the example, change it\n")),(0,r.kt)("p",null,"should I need additional ports."),(0,r.kt)("p",null,(0,r.kt)("sup",{parentName:"p",id:"fnref-2:"},(0,r.kt)("a",{parentName:"sup",href:"#fn-2:",className:"footnote-ref"},"2:"))," A subnet is basically a network inside a network. And the advantage is the most when you need to access your server from a range of IPs. Most internet service providers (ISPs) do not provide a static IP to their customers and while you ",(0,r.kt)("em",{parentName:"p"},"could")," ask them to, it's a known fact that ISPs do not provide ",(0,r.kt)("em",{parentName:"p"},"good")," services. Which is why we need to either make our IP static ourselves or allow an IP range to connect to our server, sacrificing ",(0,r.kt)("em",{parentName:"p"},"some")," security."),(0,r.kt)("h3",{id:"saas-firewalls"},"SaaS Firewalls"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},'SaaS Firewalls refer to "Software as a Service" Firewalls, often provided by your server provider (through their website) or a third party (through an application.) Certainly, they are the most convenient and easiest way to configure a firewall but due to their primitiveness; I personally advise against using them. Choose UFW if you are a beginner and iptables or (not ideally) netfilter if you are an expert.')),(0,r.kt)("h3",{id:"additional-notes"},"Additional notes"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"UFW uses iptables as its backend and is often preferred over iptables for home-servers")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"netfilter is also a choice when it comes to firewalls, but it sacrifices too much from convenience for the sake of security")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"iptables policies ",(0,r.kt)("strong",{parentName:"p"},"will not")," persist between reboots. If you want your iptables rules permanent, you will need to"))),(0,r.kt)("h2",{id:"virus-scanning"},"Virus Scanning"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Linux currently holds a smaller market share compared to Windows, and as such there are less viruses/malware targeting Linux systems. However, this does not mean that there are ",(0,r.kt)("em",{parentName:"p"},"no viruses")," targeting the Linux system. If you are dual booting Windows and Linux, or are using Linux on your server without an anti-virus; there is a chance that your system is infected. As such, you might want to install an anti-virus on your system.")),(0,r.kt)("p",null,"I personally use ClamAV and I find it to be working relatively well, but if you would like to use another AV or want to add one to this page; feel free."),(0,r.kt)("h3",{id:"installing-clamav"},"Installing ClamAV"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Install ClamAV package")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo apt install clamav clamav-daemon -y\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Verify installation")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"clamscan --V\n")),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"Enable clamav-freshclam service to automatically update virus database")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo systemctl status clamav-freshclam\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo systemctl start clamav-freshclam\n")),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},"Download/Update Signature Database")),(0,r.kt)("p",null,"Stop ClamAV service"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo systemctl stop clamav-freshclam\n")),(0,r.kt)("p",null,"Update Database"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo freshclam\n")),(0,r.kt)("p",null,"Restart ClamAV service"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo systemctl start clamav-freshclam\n")),(0,r.kt)("ol",{start:5},(0,r.kt)("li",{parentName:"ol"},"Scanning for Viruses")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Scan all files, starting from the current Directory")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"clamscan -r /\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Scan all files, but show only infected files")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"clamscan -r -i /path/to/folder-you-want-to-scan\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"To scan infected files in a specific directory and then remove them")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"clamscan --infected --remove --recursive /home/ubuntu/Desktop/\n")),(0,r.kt)("p",null,"And that is all!"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"For more information and commands, see ",(0,r.kt)("a",{parentName:"p",href:"https://linux.die.net/man/1/clamscan"},"ClamAV man page")," or run ",(0,r.kt)("inlineCode",{parentName:"p"},"clamscan -h"))))}c.isMDXComponent=!0},3745:function(e,t,a){t.Z=a.p+"assets/images/sudo-1-0ce48edfd04aedcc1896942115a99dd9.png"}}]);